Plan to Fix Vertex AI 401 Authentication Error              │ │
│ │                                                             │ │
│ │ Phase 1: Fix Environment Configuration                      │ │
│ │                                                             │ │
│ │ 1. Clean up environment variable: Remove extra space from   │ │
│ │ GOOGLE_APPLICATION_CREDENTIALS                              │ │
│ │ 2. Add missing environment variables: Set proper scopes and │ │
│ │  model-specific configs                                     │ │
│ │ 3. Verify service account permissions: Ensure the service   │ │
│ │ account has Vertex AI User and ML Developer roles           │ │
│ │                                                             │ │
│ │ Phase 2: Fix Authentication Implementation                  │ │
│ │                                                             │ │
│ │ 1. Update Vertex AI service: Modify the authentication flow │ │
│ │  to use proper Google Cloud authentication                  │ │
│ │ 2. Fix endpoint URL format: Use the correct Vertex AI       │ │
│ │ endpoint URL for SeaLion models                             │ │
│ │ 3. Add proper scopes: Include                               │ │
│ │ https://www.googleapis.com/auth/cloud-platform and          │ │
│ │ ML-specific scopes                                          │ │
│ │ 4. Implement token refresh: Add proper OAuth2 token         │ │
│ │ lifecycle management                                        │ │
│ │                                                             │ │
│ │ Phase 3: Add Fallback Strategy                              │ │
│ │                                                             │ │
│ │ 1. OpenAI routing: Route translation requests to OpenAI     │ │
│ │ when Vertex AI fails                                        │ │
│ │ 2. Error handling: Add better error messages and            │ │
│ │ diagnostics                                                 │ │
│ │ 3. Health checks: Implement endpoint availability testing   │ │
│ │                                                             │ │
│ │ Phase 4: Testing & Validation                               │ │
│ │                                                             │ │
│ │ 1. Connection test: Create endpoint to test Vertex AI       │ │
│ │ authentication                                              │ │
│ │ 2. Translation validation: Verify clean, non-verbose        │ │
│ │ responses                                                   │ │
│ │ 3. Fallback testing: Ensure graceful degradation to OpenAI  │ │
│ │                                                             │ │
│ │ This plan addresses the authentication issues while         │ │
│ │ maintaining the ultra-minimal prompt architecture we've     │ │
│ │ already implemented.                                        │ │
│ ╰─────────────────────────────────────────────────